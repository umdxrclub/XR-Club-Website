---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';

const base = import.meta.env.BASE_URL;

const departments = [
  { src: `${base}Images/partners/1.webp`, alt: 'UMD Department', url: 'https://www.cs.umd.edu/' },
  { src: `${base}Images/partners/2.webp`, alt: 'UMD Department', dark: true, url: 'https://imd.umd.edu/' },
  { src: `${base}Images/partners/3.webp`, alt: 'UMD Department', url: 'https://eng.umd.edu/' },
  { src: `${base}Images/partners/12.webp`, alt: 'UMD Department', url: 'https://umterps.com/' },
  { src: `${base}Images/partners/9.webp`, alt: 'HCIL', url: 'https://hcil.umd.edu/' },
  { src: `${base}Images/partners/6.webp`, alt: 'MAVRIC', url: 'https://mavric.umd.edu/' },
];

const companies = [
  { src: `${base}Images/partners/13.webp`, alt: 'Corporate Partner', url: 'https://www.projectaria.com/' },
  { src: `${base}Images/partners/5.webp`, alt: 'Corporate Partner', url: 'https://nianticlabs.com/?hl=en' },
  { src: `${base}Images/partners/7.webp`, alt: 'Corporate Partner', url: 'https://paraverse.cc/' },
  { src: `${base}Images/partners/8.webp`, alt: 'Corporate Partner', url: 'https://www.virnect.io/en-us/' },
  { src: `${base}Images/partners/14.webp`, alt: 'Corporate Partner', url: 'https://tanitxr.org/' },
  { src: `${base}Images/partners/15.webp`, alt: 'Corporate Partner', url: 'https://www.baltivirtual.com/' },
  { src: `${base}Images/partners/16.webp`, alt: 'Corporate Partner' },
  { src: `${base}Images/partners/17.webp`, alt: 'Corporate Partner', url: 'https://www.vuse-xr.de/' },
  { src: `${base}Images/partners/18.webp`, alt: 'Corporate Partner', url: 'https://www.awexr.com/' },
  { src: `${base}Images/partners/19.webp`, alt: 'Corporate Partner', dark: true, url: 'https://neural-lab.com/' },
  { src: `${base}Images/partners/20.webp`, alt: 'Corporate Partner', url: 'https://www.doublepoint.com/' },
  { src: `${base}Images/partners/21.webp`, alt: 'Corporate Partner', url: 'https://ixalliance.org/' },
  { src: `${base}Images/partners/23.webp`, alt: 'Corporate Partner', url: 'https://www.icxr.org/' },
  { src: `${base}Images/partners/25.webp`, alt: 'Corporate Partner', url: 'https://tech.facebook.com/reality-labs/' },
];

const studentOrgs = [
  { src: `${base}Images/partners/4.webp`, alt: 'Student Organization', url: 'https://appdevclub.com/' },
  { src: `${base}Images/partners/10.webp`, alt: 'Student Organization', url: 'https://terplink.umd.edu/organization/UMCPG' },
  { src: `${base}Images/partners/11.webp`, alt: 'Student Organization', dark: true, url: 'https://terps-making-games.itch.io/' },
  { src: `${base}Images/partners/22.webp`, alt: 'Student Organization', url: 'https://tas.umd.edu/' },
  { src: `${base}Images/partners/24.webp`, alt: 'Student Organization', url: 'https://terplink.umd.edu/organization/terrapin-beats-society' },
  { src: `${base}Images/partners/26.webp`, alt: 'Student Organization', url: 'https://startupshell.org/' },
  { src: `${base}Images/partners/27.webp`, alt: 'Student Organization', url: 'https://bit.camp/' },
  { src: `${base}Images/partners/28.webp`, alt: 'Student Organization', url: 'https://neurotech.umd.edu/' },
];
---

<BaseLayout title="Sponsors & Partners - XR Club">
  <Header />

  <section class="sp">
    <div class="sp__hero">
      <h1 class="sp__title">Sponsors & Partners</h1>
      <p class="sp__subtitle">The organizations and communities that make our work possible.</p>
    </div>

    <div class="sp__section">
      <h2 class="sp__section-title">UMD Departments</h2>
      <div class="sp__track-wrap">
        <div class="sp__track" data-carousel="left">
          {[...departments, ...departments, ...departments].map(d => d.url ? <a href={d.url} target="_blank" rel="noopener" class="sp__link"><img class:list={['sp__logo', { 'sp__logo--dark': d.dark, 'sp__logo--invert': d.invert }]} src={d.src} alt={d.alt} decoding="async" /></a> : <img class:list={['sp__logo', { 'sp__logo--dark': d.dark, 'sp__logo--invert': d.invert }]} src={d.src} alt={d.alt} decoding="async" />)}
        </div>
      </div>
    </div>

    <div class="sp__section">
      <h2 class="sp__section-title">Corporate Affiliates & Collaborators</h2>
      <div class="sp__track-wrap">
        <div class="sp__track" data-carousel="right">
          {[...companies, ...companies].map(c => c.url ? <a href={c.url} target="_blank" rel="noopener" class="sp__link"><img class:list={['sp__logo', { 'sp__logo--dark': c.dark }]} src={c.src} alt={c.alt} decoding="async" /></a> : <img class:list={['sp__logo', { 'sp__logo--dark': c.dark }]} src={c.src} alt={c.alt} decoding="async" />)}
        </div>
      </div>
    </div>

    <div class="sp__section">
      <h2 class="sp__section-title">Student Organizations</h2>
      <div class="sp__track-wrap">
        <div class="sp__track" data-carousel="left">
          {[...studentOrgs, ...studentOrgs, ...studentOrgs].map(s => s.url ? <a href={s.url} target="_blank" rel="noopener" class="sp__link"><img class:list={['sp__logo', { 'sp__logo--dark': s.dark }]} src={s.src} alt={s.alt} decoding="async" /></a> : <img class:list={['sp__logo', { 'sp__logo--dark': s.dark }]} src={s.src} alt={s.alt} decoding="async" />)}
        </div>
      </div>
    </div>
  </section>

  <Footer />
</BaseLayout>

<style>
  .sp {
    background: #fff;
    min-height: 100vh;
    width: 100%;
    overflow: hidden;
    padding-bottom: 2rem;
  }

  .sp__hero {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: clamp(10rem, 18vh, 14rem) var(--page-padding) clamp(2rem, 4vh, 4rem);
  }

  .sp__title {
    font-family: 'Inter', sans-serif;
    font-size: clamp(3rem, 6vw, 5.5rem);
    font-weight: 800;
    letter-spacing: -0.04em;
    color: #000;
    line-height: 0.95;
  }

  .sp__subtitle {
    font-family: 'Inter', sans-serif;
    font-size: clamp(1rem, 1.3vw, 1.4rem);
    font-weight: 300;
    color: rgba(0, 0, 0, 0.7);
    margin-top: 1.5rem;
    max-width: 500px;
    line-height: 1.6;
  }

  .sp__section {
    padding: clamp(3rem, 5vh, 5rem) 0;
  }

  .sp__section-title {
    font-family: 'Inter', sans-serif;
    font-size: clamp(1.3rem, 2vw, 2rem);
    font-weight: 700;
    color: rgba(0, 0, 0, 0.65);
    letter-spacing: -0.02em;
    text-align: center;
    margin-bottom: clamp(2rem, 3vh, 3rem);
  }

  .sp__track-wrap {
    width: 100%;
    overflow: hidden;
  }

  .sp__track {
    display: flex;
    align-items: center;
    gap: clamp(3rem, 5vw, 5rem);
    width: max-content;
    will-change: transform;
    animation-timing-function: linear;
    animation-iteration-count: infinite;
  }

  .sp__track--left {
    animation-name: scrollLeft;
  }

  .sp__track--right {
    animation-name: scrollRight;
  }

  @keyframes scrollLeft {
    from { transform: translateX(0); }
    to { transform: translateX(var(--track-set-width)); }
  }

  @keyframes scrollRight {
    from { transform: translateX(var(--track-set-width)); }
    to { transform: translateX(0); }
  }

  .sp__logo {
    height: clamp(7rem, 12vw, 12rem);
    width: auto;
    max-width: clamp(14rem, 22vw, 22rem);
    object-fit: contain;
    flex-shrink: 0;
    border-radius: 12px;
  }

  .sp__logo--dark {
    background: #000;
    border-radius: 12px;
    padding: 0.6rem;
  }

  .sp__logo--invert {
    filter: invert(1);
  }

  .sp__link {
    flex-shrink: 0;
    display: flex;
    transition: transform 200ms ease;
  }

  .sp__link:hover {
    transform: scale(1.05);
  }

  @media (max-width: 768px) {
    .sp__hero {
      padding: 7rem var(--page-padding) 2rem;
    }

    .sp__title {
      font-size: 2.5rem;
    }

    .sp__logo {
      height: 5.5rem;
      max-width: 13rem;
    }

    .sp__section {
      padding: 2rem 0;
    }
  }

  @media (max-width: 480px) {
    .sp__hero {
      padding: 6rem 1rem 1.5rem;
    }

    .sp__title {
      font-size: 2rem;
    }

    .sp__logo {
      height: 5rem;
      max-width: 11rem;
    }
  }
</style>

<script>
  document.addEventListener('astro:page-load', () => {
    const tracks = document.querySelectorAll('[data-carousel]');
    if (tracks.length === 0) return; // Not on sponsors page

    function initCarousel(el: HTMLElement) {
      const direction = el.dataset.carousel;
      const children = el.children.length;
      const divisor = direction === 'right' ? 2 : 3;
      const setCount = children / divisor;
      let setWidth = 0;
      for (let i = 0; i < setCount; i++) {
        const child = el.children[i] as HTMLElement;
        setWidth += child.offsetWidth;
      }
      const gap = parseFloat(getComputedStyle(el).gap) || 0;
      setWidth += setCount * gap;

      el.style.animationDuration = `${setWidth / 40}s`;
      el.classList.add(direction === 'left' ? 'sp__track--left' : 'sp__track--right');
      el.style.setProperty('--track-set-width', `-${setWidth}px`);
    }

    // Wait for all sponsor images to load before measuring widths
    const images = Array.from(document.querySelectorAll<HTMLImageElement>('.sp__logo'));
    const allLoaded = images.map(img => img.complete ? Promise.resolve() : new Promise<void>(r => { img.onload = () => r(); img.onerror = () => r(); }));

    Promise.all(allLoaded).then(() => {
      tracks.forEach(track => initCarousel(track as HTMLElement));
    });
  });
</script>
